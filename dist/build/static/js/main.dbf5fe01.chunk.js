(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{132:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),s=n(56),o=n.n(s),r=n(5),c=n(6),u=n(8),l=n(7),m=n(9),h=n(1),d=n(26),p=function(e){var t=!1;return{promise:new Promise(function(n,a){e.then(function(e){return t?a({isCanceled:!0}):n(e)},function(e){return a(t?{isCanceled:!0}:e)})}),cancel:function(){t=!0}}};var f=n(57),v=n(25),g=0,b=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={curKey:0,messages:[],hide:!1},n.getKey=n.getKey.bind(Object(h.a)(Object(h.a)(n))),n.hide=n.hide.bind(Object(h.a)(Object(h.a)(n))),n}return Object(m.a)(t,e),Object(c.a)(t,[{key:"getKey",value:function(){var e=g;return g++,e}},{key:"hide",value:function(){this.setState({hide:!0}),this.props.remove&&this.props.remove(this.props.keyVal)}},{key:"render",value:function(){var e=this.props.message;return!e||this.state.hide?null:i.a.createElement("div",{key:this.getKey(),className:e.status},e.text?e.text:e.msg,i.a.createElement("button",{onClick:this.hide},"X"))}}]),t}(a.Component),j=0;var O=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={username:"",password:"",notifications:[],loading:!1},n.changeHandler=n.changeHandler.bind(Object(h.a)(Object(h.a)(n))),n.handleSubmit=n.handleSubmit.bind(Object(h.a)(Object(h.a)(n))),n.close=n.close.bind(Object(h.a)(Object(h.a)(n))),n.addNotification=n.addNotification.bind(Object(h.a)(Object(h.a)(n))),n.removeNotification=n.removeNotification.bind(Object(h.a)(Object(h.a)(n))),n}return Object(m.a)(t,e),Object(c.a)(t,[{key:"changeHandler",value:function(e,t){this.setState(Object(f.a)({},t,e.target.value))}},{key:"handleSubmit",value:function(e){e.preventDefault();var t=this.state,n=t.username,a=t.password;this.setState({username:"",password:"",loading:!0,notifications:[]}),this.props.actionCallback(n,a,this)}},{key:"addNotification",value:function(e){console.log(e);var t=this.state.notifications.concat({status:e.status,text:e.msg,keyVal:j++});this.setState({notifications:t,loading:!1})}},{key:"removeNotification",value:function(e){var t=this.state.notifications.filter(function(t){return t.keyVal===e});this.setState({notifications:t})}},{key:"close",value:function(){this.setState({loading:!1}),this.props.close()}},{key:"render",value:function(){var e=this,t=this.state.notifications.map(function(t){return i.a.createElement(b,{key:t.keyVal,message:t,remove:e.removeNotification})});return i.a.createElement("form",{className:"authform",onSubmit:this.handleSubmit,method:this.props.method},i.a.createElement("h2",null,this.props.authFormHeading),this.state.loading?i.a.createElement("div",{style:{textAlign:"center"}},i.a.createElement(v.ClipLoader,{sizeUnit:"em",size:5,color:"#476da4"})):i.a.createElement("div",null,i.a.createElement("div",{className:"notification"},t),i.a.createElement("p",null,"Please enter your credentials for your server."),i.a.createElement("label",{htmlFor:"username"},"Username:"),i.a.createElement("input",{name:"username",type:"text",value:this.state.username,onChange:function(t){return e.changeHandler(t,"username")}}),i.a.createElement("label",{htmlFor:"password"},"Password:"),i.a.createElement("input",{name:"password",type:"password",value:this.state.password,onChange:function(t){return e.changeHandler(t,"password")}}),i.a.createElement("input",{type:"submit",value:"Submit"}),i.a.createElement("button",{onClick:this.props.close},"Cancel")))}}]),t}(a.Component),y=(n(55),0);var P=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={status:"Offline",online:!1,loading:e.loading,notifications:[]},n.name=n.props.info.name,n.mac=n.props.info.mac,n.ip=n.props.info.ip,n.pingURL="/api/ping/".concat(n.ip),n.shutdownURL="/api/shutdown/".concat(n.ip),n.restartURL="/api/restart/".concat(n.ip),n.startURL="/api/start/".concat(n.mac),n.ping=n.ping.bind(Object(h.a)(Object(h.a)(n))),n.startServer=n.startServer.bind(Object(h.a)(Object(h.a)(n))),n.addNotification=n.addNotification.bind(Object(h.a)(Object(h.a)(n))),n.shutdownServer=n.shutdownServer.bind(Object(h.a)(Object(h.a)(n))),n.restartServer=n.restartServer.bind(Object(h.a)(Object(h.a)(n))),n.pendingPromises=[],n}return Object(m.a)(t,e),Object(c.a)(t,[{key:"addNotification",value:function(e){e.key=y++;var t=this.state.notifications.concat(e);this.setState({notifications:t})}},{key:"removeNotification",value:function(e){var t=this.state.notifications.filter(function(t){return t.keyVal===e});this.setState({notifications:t})}},{key:"appendPendingPromise",value:function(e){this.pendingPromises=Object(d.a)(this.pendingPromises).concat([e])}},{key:"removePendingPromise",value:function(e){this.pendingPromises=this.pendingPromises.filter(function(t){return t!==e})}},{key:"componentDidMount",value:function(){this.ping()}},{key:"componentWillUnmount",value:function(){this.pendingPromises.map(function(e){return e.cancel()})}},{key:"ping",value:function(e){var t=this;void 0===e&&(e=3),this.setState({loading:!0});var n=p(fetch(this.pingURL));this.appendPendingPromise(n),n.promise.then(function(e){return e.json()}).then(function(a){if(!a.online&&e>0)return t.ping(e-1);t.addNotification({status:a.online?"success":"error",text:a.msg}),t.removePendingPromise(n),t.setState({loading:!1,status:a.status,online:a.online})}).catch(function(e){t.removePendingPromise(n)})}},{key:"startServer",value:function(){var e=this;this.setState({loading:!0});var t=p(fetch(this.startURL));this.appendPendingPromise(t),t.promise.then(function(e){return e.json()}).then(function(n){e.removePendingPromise(t),e.addNotification({status:n.packetSent?"info":"error",text:n.msg}),e.ping(25)}).catch(function(n){e.removePendingPromise(t)})}},{key:"shutdownServer",value:function(e,t,n){var a=this,i=p(fetch(this.shutdownURL,{headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json"},method:"POST",body:JSON.stringify({username:e,password:t})}));this.appendPendingPromise(i),i.promise.then(function(e){return e.json()}).then(function(e){a.removePendingPromise(i),a.addNotification({status:e.status,text:e.msg}),n.close()}).catch(function(e){a.removePendingPromise(i),n.addNotification({status:"error",msg:"Unable to shutdown server"})})}},{key:"restartServer",value:function(e,t,n){var a=this,i=p(fetch(this.restartURL,{headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json"},method:"POST",body:JSON.stringify({username:e,password:t})}));this.appendPendingPromise(i),i.promise.then(function(e){return e.json()}).then(function(e){a.removePendingPromise(i),a.addNotification({status:e.status,text:e.msg}),n.close()}).catch(function(e){a.removePendingPromise(i),n.addNotification({status:"error",msg:"Unable to restart server."})})}},{key:"render",value:function(){var e=this,t=this.state;if(!t)return null;var n=this.state.notifications.map(function(e){return i.a.createElement(b,{key:e.key,message:e})});return i.a.createElement("div",{className:"hover-card"},i.a.createElement("h2",null,this.name),i.a.createElement("div",{className:"notification"},n),i.a.createElement("table",null,i.a.createElement("tbody",null,i.a.createElement("tr",null,i.a.createElement("th",null,"Status:"),i.a.createElement("td",null,this.state.loading?i.a.createElement(v.ClipLoader,{className:"\n  margin: 0;\n",sizeUnit:"em",size:1,color:"#476da4"}):i.a.createElement("span",{className:["status-ctn",t.status].join(" ")},t.status," ",i.a.createElement("button",{onClick:this.ping},"Check Status")))),i.a.createElement("tr",null,i.a.createElement("th",null,"MAC:"),i.a.createElement("td",null,this.mac)),i.a.createElement("tr",null,i.a.createElement("th",null,"IP:"),i.a.createElement("td",null,this.ip)))),i.a.createElement("div",{className:"btn-ctn"},t.online?i.a.createElement("span",null,i.a.createElement("button",{onClick:function(){return e.props.showAuthForm("Restart Server",e.restartServer)},disabled:this.state.loading},"Restart"),i.a.createElement("button",{onClick:function(){return e.props.showAuthForm("Shutdown Server",e.shutdownServer)},disabled:this.state.loading},"Shut Down")):i.a.createElement("button",{disabled:this.state.loading,onClick:this.startServer},"Start")))}}]),t}(a.Component),k=function(e){function t(){return Object(r.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return!this.props.servers||this.props.servers.length<1?null:i.a.createElement("div",null,this.props.servers.map(function(t){return i.a.createElement(P,{key:t.mac,showAuthForm:e.props.showAuthForm,info:t})}))}}]),t}(a.Component);function E(e){return i.a.createElement("button",{className:"logbtn",onClick:e.onClick},e.text)}var S=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={user:null,modalDisplay:!1,servers:[]},n.showAuthForm=n.showAuthForm.bind(Object(h.a)(Object(h.a)(n))),n.hideAuthForm=n.hideAuthForm.bind(Object(h.a)(Object(h.a)(n))),n.logIn=n.logIn.bind(Object(h.a)(Object(h.a)(n))),n.logOut=n.logOut.bind(Object(h.a)(Object(h.a)(n))),n.pendingPromises=[],n.appendPendingPromise=function(e){this.pendingPromises=Object(d.a)(this.pendingPromises).concat([e])}.bind(Object(h.a)(Object(h.a)(n))),n.removePendingPromise=function(e){this.pendingPromises=this.pendingPromises.filter(function(t){return t!==e})}.bind(Object(h.a)(Object(h.a)(n))),n}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.getUserData(),this.getServerData()}},{key:"getUserData",value:function(){var e=this,t=p(fetch("/api/user"));this.appendPendingPromise(t),t.promise.then(function(e){return e.json()}).then(function(n){"error"!==n.status&&(e.removePendingPromise(t),e.setState({user:n}))}).catch(function(){return e.removePendingPromise(t)})}},{key:"getServerData",value:function(){var e=this,t=p(fetch("/api/servers"));this.appendPendingPromise(t),t.promise.then(function(e){return e.json()}).then(function(n){e.removePendingPromise(t),"error"!==n.status&&e.setState({servers:n})}).catch(function(n){e.removePendingPromise(t),e.setState({servers:[]})})}},{key:"showAuthForm",value:function(e,t){var n=e||"Authorization Required";this.setState({modalDisplay:!0,modalAction:t,authFormHeading:n})}},{key:"hideAuthForm",value:function(){this.setState({modalDisplay:!1})}},{key:"logIn",value:function(){var e=this;this.showAuthForm("Log In",function(t,n,a){var i=p(fetch("/api/user/login",{headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json"},method:"POST",body:JSON.stringify({username:t,password:n})}));e.appendPendingPromise(i),i.promise.then(function(e){return e.json()}).then(function(t){if("error"===t.status)return console.log("error"),a.addNotification(t);e.setState({user:t.user}),e.getServerData(),a.close()}).catch(function(e){a.addNotification(e)})})}},{key:"logOut",value:function(){var e=this,t=p(fetch("/api/user/logout"));this.appendPendingPromise(t),t.promise.then(function(e){return e.json()}).then(function(t){"success"===t.status?e.setState({user:null}):(console.log(t),alert("Unable to log out."))}).catch(function(e){return console.log(e)})}},{key:"render",value:function(){return i.a.createElement("div",{className:"App"},i.a.createElement("div",null,i.a.createElement("h1",null,"Home Control"),this.state.user?i.a.createElement("h2",null,"Welcome, ",this.state.user.name):i.a.createElement("h2",null,"Welcome"),this.state.user?i.a.createElement(k,{servers:this.state.servers,showAuthForm:this.showAuthForm}):i.a.createElement("p",null,"You must log in first.")),this.state.modalDisplay?i.a.createElement("div",{className:"modal"},i.a.createElement(O,{authFormHeading:this.state.authFormHeading,actionCallback:this.state.modalAction,close:this.hideAuthForm,method:"POST"})):null,this.state.user?i.a.createElement(E,{onClick:this.logOut,text:"Log Out"}):i.a.createElement(E,{onClick:this.logIn,text:"Log In"}))}}]),t}(a.Component);o.a.render(i.a.createElement(S,null),document.getElementById("root"))},55:function(e,t,n){},60:function(e,t,n){e.exports=n(132)}},[[60,2,1]]]);
//# sourceMappingURL=main.dbf5fe01.chunk.js.map